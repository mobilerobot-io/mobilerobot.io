<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
<link rel="stylesheet" href="http://mobilerobot.io/css/style.css">


<title>Motors</title>
<body><header class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
	<a class="navbar-brand text-muted text-monospace" href="http://mobilerobot.io/">Mobile Robot I/O</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
	    <nav class="navbar-nav justify-content-end">
  		<a class="nav-link" href="http://mobilerobot.io/">home</a>
  	        <a class="nav-link" href="http://mobilerobot.io/projects">projects</a>
  	        <a class="nav-link" href="http://mobilerobot.io/notes">notes</a>
  		<a class="nav-link" href="http://mobilerobot.io/about">about</a>
 	    </nav>
	</div>
    </nav>
</header>
<div class="jumbotron bg-white">
    <div class="row">
	<div class="col"></div>
	<div class="col-md-6">
	    <h1 class="text-center header pb-1">Motors</h1>
	    <h5 class="leadin text-center text-muted mt-0">
		
	    </h5>
	</div>
	<div class="col"></div>
    </div>
</div>
<div id="main">
<div class="container">
    <div class="row">
	
	<div class="col-4 text-center">
	    <div class="card">
		<div class="card-title">
		    Raspberry Pi Motor Control Software
		</div>
		<div class="card-body">
		    <blockquote>
<p>TODO ~ replace image with one of the Raspberry Pi Controller</p>
</blockquote>

<p>This software adds a Skid Steer motor control software to the
<a href="http://github.com/mobilerobot-io/rpid">Raspberry Pi Device Server</a>
device server.  RPID adds motor controls accessible via both MQTT and
REST APIs, as well as directly with the Skidder python library.</p>

<p>This project was to build a simple automous driving vehical using a
single Raspberry Pi and a simple DC motor controller.  The RPi acts
as the macro controller making control decisions and managing
communications.
<!--more--></p>

<p>The same RPi is also the Micro-controller, in other words on this
Robot the RPi is both the Macro and Micro controllers, making the
control decision as well as executing the control commands.</p>

<h2 id="controlling-the-motors">Controlling The Motors</h2>

<p>This software is a component that plugs into the
<a href="http://mobilerobot.io/projects/rpid">Raspberry Pi Device Server (RPID)</a>
allowing the motors to be controlled directly by the Skidder API, or
via MQTT messages and/or HTTP REST requests. Oh, there is also a
keyboard controller if you ssh into the vehicle.</p>

<blockquote>
<p>TODO Place image 5-17 img-1 here</p>
</blockquote>

<h3 id="mqtt-skid-channel">MQTT Skid Channel</h3>

<p>The RPID MQTT server will subscribe to the <em>/control/skid</em> channel and
respond to commands accordingly.  Skid channel is simple, expecting
two floating point numbers, representing the load (voltage) supplied
to the motors.</p>

<pre><code class="language-bash">% mosquitto_sub -t /control/skid 
</code></pre>

<p>Messages to control our skid steer vehical over MQTT will basically be
two floating point values between -1 and +1 inclusive.  The numbers
represent the percentage of the load to let the motors have (throttle)
and the +/- sign represents the direction the motor will turn.</p>

<blockquote>
<p>/control/skid:l/r</p>
</blockquote>

<h3 id="rest-skid-endpoint">REST Skid Endpoint</h3>

<blockquote>
<p>GET /skid/
PUT /skid/l/r</p>
</blockquote>

<p>Get or Set the left and right throttles.  The throttles values are
represented by floating point numbers between -1 and 1 inclusive,
representing the percentage of load, and direction that will be
applied to the right and left throttles.</p>

<h2 id="adafruit-rpi-motor-controller">Adafruit RPi Motor Controller</h2>

<p>For this Robot, we are using the wonderful <a href="http://adafruit.com/todo">Adafruit Raspberry Pi
DC/Stepper motor controller</a>. This is the
<em>one</em> robot that we directly drive a motor controller from the
Raspberry Pi.  That aspect of this project differs than our other
robots that are built with
<a href="http://mobilerobot.io/notes/distributed-controllers">distributed controllers</a> used by the
other robots I have built.</p>

<h3 id="rpi-macro-controler-and-micro-controller">RPi Macro Controler and Micro Controller</h3>

<p>In other cases the <em>Master Controller</em> software runs run on a
Raspberry Pi (or most any other debian linux host like a laptop or
Jetson Nano) where as the <em>Micro Controller</em> typically runs on an
embedded <em>Arduino like device</em>, possibly an esp8266, esp32 or stm32.</p>

<h3 id="localized-micro-and-macro-controllers">Localized Micro and Macro Controllers</h3>

<p>In this software we will keep the same message based communication
system, as well as REST support architecture as used on the other
robots.  In this case we will implement the Micro-controller
requirements as part of the <a href="http://mobilerobot.io/todo">RPi DeviceService</a> used by the
<a href="http://mobilerobot.io/todo">Raspberry Pi Camera server</a>.</p>

<p>That means we will be able to control the voltage sent to (throttle)
the motors and hence control speed and direction the vehicle moves.</p>

<h2 id="a-note-about-performance-and-communicaiton-overhead">A Note about Performance and Communicaiton Overhead</h2>

<p>In this case the RPi with minimal sensors, low speed motors and maybe
a camera should be easily at home in a single multi-core RPi.  This
being the case, we could optimize communications by removing the
messaging and translation layers from the
<a href="http://mobilerobot.io/mobile-robot-architecture">MBR Architecture</a>.</p>

<p>However, for the sake of a single architecture and minimized set of
software tools and configurations, we will leave the communicaiton
layers in place.</p>

<p>Consistency and maintainance are extreemly important when it comes to
real-world production systems. But would we choose this over
performance in a production system?</p>

<p>The answer depends on the demands of the application, in this case, I
suspect the level of communicaiton overhead will be minimal, or
trivial when compared to the Bandwidth and other resources available.
That I believe removing the communicaitons layer would provide no
noticible, production quality performance improvements.  And at the
cost of maintanance and complexity.</p>

<p>Of course speculation takes a deep backseat to real world numbers and
careful testing.  So, I reserve the <em>right to be wrong</em>!</p>

<h3 id="brushed-dc-motors">Brushed DC Motors</h3>

<p>We are using <em>Brushed DC</em> motors, about the cheapest possible motors
one can buy.  These particular motors accept 6 to 12v.  Powering bots
is particularly important, if you want to chase your tail on weird
problems, work with under powered electronics for a while!</p>

<h2 id="powering-the-vehicle">Powering The Vehicle</h2>

<p>We can not share power with the Raspberry Pi as it does not have
nearly enough power to run two motors, especially during heavy load.
Therefore we must seek out additional power to be supplied
independently to the Motor Controller.</p>

<h3 id="motor-control-software">Motor Control Software</h3>

<p>The control software that rides on the raspberry pie will consist of,
A copy of an empty MQTT broker, most likely mosquito. It will also
consist of The control software described in (Control Software
Design)[/notes/control-software-design] in the notes section of this
site.</p>

<h3 id="speed-and-steering">Speed and Steering</h3>

<p>In this case we have a two wheel vehicle, with two motors. Our control
Algorithm will employ skid steering, The simplest possible navigation
mechanism we could develop.</p>

<p>Hence, The control algorithm will take its inputsTranslate them into
skid steer during instructions,Which basically consists of varying the
velocityOf the right and left group of wheels, In our case two
wheels.</p>

<h3 id="outputs">Outputs</h3>

<p>Since the motors are controlled directly by Adafruit software, we will
may create an individual process, separate from the control software
just to handle the motor controls.</p>

<h2 id="bill-of-materials">Bill of Materials</h2>

<ul>
<li>Raspberry Pi V3+</li>
<li>Adafruit Motorsheild</li>
<li>Extra battery pack for motors</li>
<li>2 brushed DC motors</li>
<li>2 wheeled cheap balancing disk for body</li>
<li>Application specific sensors</li>
</ul>
		</div>
	    </div>

	</div>
	
	<div class="col-4 text-center">
	    <div class="card">
		<div class="card-title">
		    Arduino Motor Control Software
		</div>
		<div class="card-body">
		    

<p>Pictured about is the <a href="https://www.osepp.com/electronic-modules/shields/120-motor-shield-6612">OSEPP v2
Motor Shield</a>
which can be used as a functional replacement to the <a href="https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi/using-dc-motors">Adafruit v2
motorshield</a>,
the motorshield I recommend.</p>

<blockquote>
<p>Source code can be found here
<a href="http://github.com/mobilerobot-io/arduino/">http://github.com/mobilerobot-io/arduino/</a>
within the src/mctl directory.</p>
</blockquote>

<h2 id="arduino-motorsheild-and-distributed-controls">Arduino Motorsheild and Distributed Controls</h2>

<p>The software in the repository is to be loaded on an Arduino with
either an Adafruit v2 Arduino or OSEPP 6612 MotorShield.  The software
accepts commands as incoming text strings from one of several possible
<em>serial inputs</em>; UART, RF Radio, Blue Tooth, etc.</p>

<blockquote>
<p>TODO: place diagram showing an arduino accepting commands from a RPi</p>
</blockquote>

<p>Input commands are parsed and the commands are acted on
accordingly. For example, our SkidSteer provide the following
<em>throttle</em> method to change the speed and direction of the vehicle.</p>

<p>I prefer to use an Arduino with a <em>Motor Shield</em> as a dedicated
micro-controller regulating the voltage supplied to the DC motors, it
may carry on local conversions or control calculations dedicated to
proper motor handling.</p>

<p>Additional sensors and guidance inputs can be handled by additional,
perhaps less critical controllers.  Hopefully reducing the chance of
critical motor controllers from failing.</p>

<h3 id="the-big-skidder">The Big Skidder</h3>

<p>My primary vehical is a 4wd, that is 4 DC motors directy spinning two
rubber tires.  I also have available two, two wheeled vehicals and a
<em>train tracked</em> vehical.</p>

<p>In all cases each of these vehicle employ <a href="http://mobilerobot.io/notes/skid-steering"><em>skid
steering</em></a> on account a one wheel (wheels or
tread) will be skidding along when your turnin.</p>

<h2 id="required-motors-and-controller">Required Motors and Controller</h2>

<p>We need to power the following motors (at minimum):</p>

<ul>
<li>4 DC Motors</li>
<li>2 Servos</li>
</ul>

<h2 id="adafruit-motorshield">Adafruit MotorShield</h2>

<p>The first phase of building Robots I recommend the Adafruit Motor
Shield V2.  I also tried the OSEPP 6612 and Adafruit Motor Shield v1
(before I realized there was a version 2).</p>

<p>Links to the shields can be found here:</p>

<ol>
<li><a href="https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi/using-dc-motors">Adafruit v2 Arduino DC/Stepper MotorController</a></li>
<li>[OSEPP v2 MotorController]()</li>
</ol>

<blockquote>
<p>Insert picture of Adafruit Motor shield</p>
</blockquote>

<h3 id="osepp-shields-v1-v2">OSEPP Shields v1 &amp; v2</h3>

<p>The OSEPP MotorSheilds effectively duplicate the functionality of the
Adafruite MotorShields.</p>

<p>The documentation is hard to find and must be pieced together through
the documentation of their hardware kits.  I do find the hardware to
be of a sturdy make.  The use connectors to help in learning, the
Adafruit are more through for real prototyping.</p>

<p>For particular details about the controller and other hardware please
refer to the Adafruit and respective product websites.</p>

<h2 id="arudio-mctl-software">Arudio MCTL Software</h2>

<p>The code in this library can be compiled by with the
<a href="http://arduino.io/downloads">Arduino IDE</a> to an UNO with an Adafrutit
v.2 (or compatible) motor controller.  One of the MBR vehicles OSEPP
Two Wheel balancer uses an OSEPP motor library wich is very similar
(but) different than the Adafruit version.</p>

<h3 id="reads-from-serial-input">Reads From Serial Input</h3>

<p>This could be virtually any &ldquo;stream&rdquo; of data from a UART, RF, Blue
Tooth or Wifi ports.  Regardless, the software reads from the
appropriate input, parses the incoming commands and adjusts power to
the motors accordingly.</p>

<blockquote>
<p>Place snippet of Skidder software class here</p>
</blockquote>

<h3 id="mqtt-and-motor-control-channel">MQTT and Motor Control Channel</h3>

<p>Connect the motor controller to the MQTT control channel.  NOTE: on
vehicle may use the motor control channel when availble, however, must
always be able to regain control (or shutdown completely) if the
control channel has been lost.</p>

<h2 id="testing-and-validation">Testing and Validation</h2>

<p>How is this software tested and valided for promotion?</p>

<blockquote>
<p>Todo document the testing procedure</p>
</blockquote>

<h2 id="maintanance-and-upgrades">Maintanance and Upgrades</h2>

<blockquote>
<p>Todo document the deployment and production release producedure.</p>
</blockquote>

<p>Alas, too many projects, to little time!</p>

		</div>
	    </div>

	</div>
	
	<div class="col-4 text-center">
	    <div class="card">
		<div class="card-title">
		    Inexpensive Motor Controllers for Arduino and Raspberry Pi
		</div>
		<div class="card-body">
		    <p>I prefer to use an Arduino with a Motor Controller over say a
Raspberry Pi with a motor-controller.  I believe the Arudino has
better support for dedicated Real-time software vs. the Raspberry Pi
and as a superior platform for general computing including running
Control Software.  This is how we do it on the West side &hellip;</p>

<p>Whenever started to build a mobile robot and first started this
project I set out to pick up motor controller and a platform to
buildMy Tom&rsquo;s vehicle around. The two most on his choices at least to
me were a Raspberry Pie or an Arduino.  As I found out selecting
either platform I choose it would have been a bad idea, and here is
why.</p>

<p>I eventually realized that neither platform, the Raspberry Pie nor the
Arduino had everything I really wanted.  The Arduino certainly lacks a
robust development environment, which Is great for getting started
programming embedded devices, but hardly sufficient for Somebody that
makes a living programming.</p>

<h2 id="niether-one-will-cut-it">Niether one will Cut it</h2>

<p>The Raspberry Pi hardware and Linux OS are not well suited for an
&ldquo;embedded real time&rdquo; system.  But does offer an endless choice of
development environments.</p>

<h3 id="leave-our-options-open">Leave our Options Open</h3>

<p>It became clear, that neither platgorm would be ideal for my general
development plans.  Neither of them were ideal to solely commit to.</p>

<p>However, if I could combine them, I could get quite a bit further, by
having access to the advantages that both worlds?Add</p>

<p>Before I get into any detail on these &ldquo;hobby&rdquo; controllers is</p>

<p>What are the first things to consider when developing a mobile robot
Is how you&rsquo;re going to make it move, and that is typically using
motors.  The cool thing is that inexpensive electrical motors are
plentiful, however putting them to good use is a bit complex, Here we
will conquer some of that complexity.</p>

<p>We will consider the following 3 things:</p>

<ol>
<li>What <em>type</em> of motor(s) do we need?</li>
<li>How are we going to <em>power</em> them?</li>
<li>How are we going to <em>control</em> them?</li>
</ol>

<h2 id="tldr-summary">TLDR - Summary</h2>

<p>I have settled on the Adafruit MotorSheilds for Arudino and Raspberry
Pi as general purpose options.  At the moment, my ideal setup involves
a RPi as the controller with an I2C or SPI connection to an Arduino
with a MotorController.</p>

<p>But not for every circumstance.  It always depends on the application,
having said that, let me explain what I have found (very little) so
far with inexpensive electric motors&hellip;</p>

<h2 id="project-requirements">Project Requirements</h2>

<p>First let me frame this discussion, I am strictly talking about cheap
DC motors (not AC that plug into the wall like a washing machine) that
can be had for less than $10USD, often less than $1 or found in scrap
electronics.</p>

<p>The first three motor types I discovered are the ubiquitous: DC
<em>brushed motor</em>, <em>toy servos</em> and <em>stepper motors</em>.  Incase you are
uninformed like I was in early 2018..</p>

<h3 id="select-motors-and-motor-controller">Select Motors and Motor Controller</h3>

<p>The purpose of this project is to select the motors and the
corresponding <em>motor controller</em> we need to control our vehicle.  The
motorshield will come as an attachment to a micro controller of some
sort, which happens to be either an Arduino or Raspiberry Pi, in my
case.</p>

<h3 id="brushed-motors-move-wheels">Brushed Motors Move Wheels</h3>

<p>In a nutshell, the brushed motors we&rsquo;ll use to turn the wheels of the
vehicle, they have the advantages of being easily controlled (speed
up, slow down, stop) with just two wires (+ and -), the direction
of the motor can be changed simply by reversing the current to the
motor.</p>

<p>They are also really cheap and can be found every where, including
scrap electronic toys and utilties.</p>

<h3 id="servos-to-pan-and-tilt-camera">Servos to Pan and Tilt Camera</h3>

<p>We will include two inexpensive <em>servos</em> onto the vehicle to handle
the <em>pan and tilt</em> camera functions.</p>

<h2 id="drive-train">Drive Train</h2>

<p>Moving the vehicle is one thing, steering it is a whole nother
thang. Fortunantely for us, we are going to adopt the fine art of
<strong>skid steering</strong>, the age old method of how the caveman commutted
back in the day.</p>

<h3 id="skid-steering">Skid Steering</h3>

<p>My primary vehical is a 4wd, that is 4 DC motors directy spinning two
rubber tires.  I also have available two, two wheeled vehicals and a
<em>train tracked</em> vehical.</p>

<p>In all cases each of these vehicle employ <em>skid steering</em> on account a
one wheel (wheels or tread) will be skidding along when your turnin.</p>

<p><a href="http://mobilerobot.io/todo/skid-steering">TODO ~ Create a skid steering page</a></p>

<p>Of course, you can get real fancy and spin the thing on axis by
employing equal forces of forward and reverse on opposing sides of the
vehicle.  Which does have significant advantages in tight areas such
as those found in long corridors, warehouses and such.</p>

<h2 id="required-motors-and-controller">Required Motors and Controller</h2>

<p>We need to power the following motors (at minimum):</p>

<ul>
<li>4 DC Motors</li>
<li>2 Servos</li>
</ul>

<p>Cut to the chase, the Adafruit XXXXX Arduino motor controller, and the
sister Adafruit YYYY stepper motor controller for the Raspberry Pi are
two such controllers that suite our purposes perfectly well.</p>

<h3 id="which-microcontroller-microcomputer">Which MicroController (MicroComputer)?</h3>

<p>Todo has a discussion of using a Raspberry Pi + MotorController or
Arduino + Motor Controller.</p>

<h3 id="alternative-shields">Alternative Shields</h3>

<h3 id="adafruit-sheild-v1-v2">Adafruit Sheild v1 &amp; v2</h3>

<p>Adafruit essentially has two versions of their MotorShield v1 and now
v2. &hellip;</p>

<h4 id="version-2-i2c">Version 2 I2C</h4>

<p>Version 2 of the AFMS runs over the I2C bus.</p>

<h3 id="osepp-shields-v1-v2">OSEPP Shields v1 &amp; v2</h3>

<p>The OSEPP MotorSheilds effectively duplicate the functionality of the
Adafruite MotorShields.</p>

<p>The documentation is hard to find and must be pieced together through
the documentation of their hardware kits.  I do find the hardware to
be of a sturdy make.  The use connectors to help in learning, the
Adafruit are more through for real prototyping.</p>

<h2 id="motor-software">Motor Software</h2>

<p>Adafruit software for Arduino MC and Raspberry Pi MC.</p>

<h3 id="mqtt-and-motor-control-channel">MQTT and Motor Control Channel</h3>

<p>Connect the motor controller to the MQTT control channel.  NOTE: on
vehicle may use the motor control channel when availble, however, must
always be able to regain control (or shutdown completely) if the
control channel has been lost.</p>
		</div>
	    </div>

	</div>
	
    </div>
</div>

    </div><footer id="footer" class="container mb-5 pb-5">
    <div class="row mt-5 pt-5">
	<div class="col-2"></div>
	<div class="col-8">
	  <span class="copyright">Eddy Consulting, LLC, Copyright 2006-2019</span>
	</div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138892687-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9757293';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9757293.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>


</body>
</html>
